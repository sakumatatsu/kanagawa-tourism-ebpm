# 神奈川県観光振興EBPMダッシュボード 開発記録

## プロジェクト概要

- **目的**: 神奈川県の観光振興施策をEBPM（Evidence-Based Policy Making）の観点から高度化するためのダッシュボード構築
- **背景**: 神奈川県が総合計画（新かながわグランドデザイン）の見直しを控えており、観光振興の現状を多角的・定量的に把握する必要がある
- **利用者**: 神奈川県庁の観光振興担当職員
- **公開URL**: https://sakumatatsu.github.io/kanagawa-tourism-ebpm/
- **リポジトリ**: https://github.com/sakumatatsu/kanagawa-tourism-ebpm

---

## Day 1: 2026年2月22日（土）

### 実施内容

#### フェーズ1: 要件定義（23:50〜00:01）
ユーザーとの対話形式で9つの設計質問を通じて要件を確定。

- **アウトプット形態**: Webダッシュボード（スタンドアロンHTML）、将来的にBIツール連携
- **利用者**: 県庁観光振興担当職員
- **対象範囲**: 全県横断（横浜・鎌倉・箱根・湘南・三浦等の7エリア）
- **データ更新**: 当面は静的データ、将来的に定期更新
- **アウトカム指標**: 総合計画見直し前のため幅広く総合的に把握
- **因数分解の切り口**: 施策・事業別（最優先）、地域別、観光資源タイプ別、旅行者属性別
- **ベース計画**: 新かながわグランドデザイン PJ5（観光・地域活性化）
- **可視化方式**: サンバーストチャート（ツリーマップより階層表現に優れる）
- **UXコンセプト**: 「思考フローに沿ったドリルダウン」— ユーザーが切り口を選択→構成要素を掘り下げ→利用可能データが明らかになる

#### フェーズ2: 計画策定・調査（00:01〜00:17）
- 新かながわグランドデザインのPJ5構造を調査
  - 3本の柱（A: 観光の振興、B: 地域にひとの流れ、C: 移住・定住）を特定
  - 各施策のKPI・数値目標を収集
- `PLAN.md` を作成（ロジックモデル、UI/UX設計、技術スタック、ファイル構成、実装フェーズ）

#### フェーズ3: データソース調査（00:17〜00:34）
ユーザーからの要望で、グランドデザイン記載データ以外の統計データを幅広く追加。3つの調査エージェントを並行実行:

1. **e-Stat統計データ調査** → 30以上の国の公的統計を特定、神奈川県での利用可否・粒度・API情報を整理
2. **神奈川県独自公表データ調査** → 入込観光客調査、観光客実態調査、経済波及効果分析ツール、県勢要覧等を特定
3. **民間人流・消費データ調査** → モバイル空間統計、Agoop、JCB消費NOW、各鉄道会社の乗降データ等40以上のソースを調査

成果物:
- `e-Stat統計データ調査報告書.md`（32,162 bytes）
- `data_sources_survey.md`（48,711 bytes）
- `DATA_SOURCES.md`（23,362 bytes）

#### フェーズ4: ダッシュボード実装（00:31〜00:40）
4ファイル構成でフルスクラッチ実装:

- `index.html` — メインHTML（ヘッダー、KPIサマリー、切り口タブ、サンバーストチャート、データソースカタログ）
- `js/data.js` — 全データ定義（4つの因数分解ツリー、50以上のデータソース、KPI目標値）
- `js/app.js` — D3.js v7によるサンバーストチャート、インタラクティブUI、詳細パネル
- `css/style.css` — レスポンシブ対応スタイリング

#### フェーズ5: KPI連動機能の実装（00:40〜00:56）
ユーザーからのフィードバック: 「最上位KPIサマリーとサンバーストチャートが切り離されている」

対応:
- KPI×切り口の対応マッピング（`kpiPerspectiveMapping`）をデータに追加
- `renderKPISummary()` を拡張し、切り口選択時に構成比スタックドバーを表示
- 対応データがないKPIカードを半透明化（「この切り口では分解不可」を視覚表示）
- サンバースト要素クリック時の貢献度バッジ表示（値と割合）
- 構成比バーのセグメント色をサンバーストと統一

#### フェーズ6: GitHub Pagesデプロイ（01:01〜01:18, 05:13〜05:18）
- GitHub CLI (gh) をインストール（Homebrewはsudo権限不足のため直接バイナリダウンロード）
- GitHubアカウント認証（ブラウザ経由のOAuthデバイスフロー）
- publicリポジトリ `kanagawa-tourism-ebpm` を作成・push
- GitHub Actions ワークフロー（`deploy.yml`）を追加
- workflowスコープの追加認証を実施
- GitHub Pages でのデプロイ完了を確認

### Day 1 時点の成果物

| ファイル | 行数 | 概要 |
|---------|------|------|
| `index.html` | 95行 | メインHTML構造 |
| `js/app.js` | 771行 | アプリケーションロジック（D3サンバースト、KPI連動、インタラクション） |
| `js/data.js` | 777行 | 全データ定義（因数分解ツリー×4切り口、50+データソース、KPIマッピング） |
| `css/style.css` | 830行 | スタイルシート（レスポンシブ対応、KPI連動用スタイル含む） |
| `.github/workflows/deploy.yml` | 34行 | GitHub Pages自動デプロイ |
| `PLAN.md` | — | プロジェクト計画書 |
| `DATA_SOURCES.md` | — | 神奈川県固有データソース調査結果 |
| `data_sources_survey.md` | — | 民間・準公的データソース調査結果 |
| `e-Stat統計データ調査報告書.md` | — | e-Stat統計データ調査結果 |

### Day 1 時点の機能一覧

- [x] 最上位KPIサマリー（観光消費額・入込客数・宿泊者数・満足度の4指標）
- [x] 4つの因数分解切り口（施策・事業別 / 地域別 / 観光資源タイプ別 / 旅行者属性別）
- [x] D3.jsサンバーストチャートによる階層的可視化
- [x] クリックによるドリルダウン（パンくずリスト連動）
- [x] 詳細パネル（KPI目標値、利用可能データソース一覧）
- [x] KPIサマリーと切り口の連動（構成比バー、貢献度バッジ、dimmed表示）
- [x] データソースカタログ（9カテゴリ、54データソース）
- [x] ツールチップ（ホバー時の情報表示）
- [x] レスポンシブデザイン（1024px / 768px / 480px ブレークポイント）
- [x] GitHub Pagesによる外部公開

---

## Day 2: 2026年2月23日（日）

### 実施内容

#### フェーズ1: 実データ調査・収集（14:00〜14:56）

3つの調査エージェントを並行実行し、2019〜2024年度の公的統計データを収集:

1. **主要KPI・地域別データ収集エージェント**
   - 神奈川県入込観光客調査の公式ページから2019〜2024年の全データを直接確認
   - 延べ入込観光客数: 2024年 20,806万人（過去最高）を確認
   - 7エリア別データ: 2022年以降は7地域区分、2019-2021年は旧6地域区分であることを発見
   - 既存推計値との重大な乖離を検出（例: 2021年 13,670万人→正しくは11,725万人）

2. **有料データソース価格調査エージェント**
   - 10サービスの価格体系を調査（モバイル空間統計、Agoop、ゼンリン、unerry、LocationMind、NAVITIME、Custella、Visa、TripAdvisor、Google Maps）
   - Google Maps Platform以外はすべて「要問合せ」型の価格体系
   - 年額レンジ（数十万〜数千万円）と価格モデルを整理

3. **宿泊旅行統計調査エージェント**
   - 観光庁のExcel/PDFデータの所在を特定
   - データがPDF/Excel形式のみのため、ウェブ直接取得は困難と判明

**主な発見事項:**
- 地域区分が2022年に6→7区分に変更されていた（第5期観光振興計画に基づく新区分）
- 2019-2021年の「足柄」エリアは独立区分が存在しない
- 観光消費額・満足度データはPDF内のみで公表（ウェブページ本文に数値なし）

#### フェーズ2: ファイル構成の変更（14:20〜14:40）

**新規作成:**
- `js/actual-data.js` — 実データファイル（約330行）
  - `ACTUAL_DATA.topKPIs`: 最上位4KPI × 6年分時系列
  - `ACTUAL_DATA.regionTimeSeries`: 7地域 × 6年分（入込客数・宿泊客数）
  - `ACTUAL_DATA.subKPIs`: 8サブKPI × 6年分時系列
  - `ACTUAL_DATA.paidDataCosts`: 10有料データソースのコスト情報

**修正:**
- `index.html` — `<script src="js/actual-data.js">` を追加（1行）
- `js/data.js` — `timeSeriesKey`（4箇所）、`costId`（10箇所）を追加
- `js/app.js` — トレンドチャート・コスト表示機能を追加（約200行）
- `css/style.css` — トレンドチャート・コストバッジ等のスタイル追加（約90行）

#### フェーズ3: トレンドチャート機能の実装（14:25〜14:40）

`js/app.js` に以下の機能を追加:

1. **`hasActualData()` 関数** — graceful degradation用の存在チェック
2. **`renderTrendChart()` 関数** — D3.jsによるバーチャート（約100行）
   - X軸: 年度（2019〜2024）、Y軸: 実績値
   - COVID年（2020, 2021）は薄い色で表示
   - null値は「未公表」ラベルで処理
   - 目標値がある場合は点線で表示
3. **KPIカード展開機能** — 各カードに▼ボタン、クリックでトレンドチャート表示
4. **詳細パネルへのトレンドチャート統合** — サブKPIにもチャート表示
5. **有料データソースのコスト表示** — `💰 推定コスト: ...` バッジ表示
6. **データ鮮度インジケーター** — ヘッダーに最終更新日を表示

#### フェーズ4: データ検証・修正（14:56〜15:10）

調査エージェントの結果に基づき `actual-data.js` のデータを修正:

| データ項目 | 修正前 | 修正後（公式確認値） |
|-----------|--------|-------------------|
| 延べ入込観光客数 2019 | 19,818万人 | **20,467万人** |
| 延べ入込観光客数 2020 | 10,550万人 | **10,849万人** |
| 延べ入込観光客数 2021 | 13,670万人 | **11,725万人** |
| 延べ入込観光客数 2022 | 16,400万人 | **16,406万人** |
| 横浜・川崎 2019 | 7,500万人 | **7,599万人** |
| 横浜・川崎 2022 | 6,400万人 | **5,743万人** |
| 三浦半島 2019 | 1,580万人 | **1,650万人** |
| 県西地域 2023 | 3,500万人 | **3,685万人** |
| 県西地域 2024 | 3,600万人 | **3,789万人** |
| 足柄 2019-2021 | 推計値 | **null**（区分なし） |

#### フェーズ5: GitHub Pagesデプロイ

- 全変更をコミット・プッシュ
- GitHub Pagesでの動作確認

### Day 2 時点の成果物

| ファイル | 行数 | 概要 |
|---------|------|------|
| `index.html` | 96行 | メインHTML（actual-data.js読み込み追加） |
| `js/app.js` | ~970行 | トレンドチャート、コスト表示、データ鮮度表示を追加 |
| `js/data.js` | ~790行 | timeSeriesKey、costId マッピングを追加 |
| `js/actual-data.js` | ~330行 | **新規** — 実データ（時系列＋コスト情報） |
| `css/style.css` | ~920行 | トレンドチャート、コストバッジ等のスタイル追加 |

### Day 2 で追加された機能

- [x] 最上位4KPIの実績値表示（ACTUAL_DATAの最新値で自動更新）
- [x] 5年間経年比較トレンドチャート（D3.jsバーチャート、展開/折りたたみ式）
- [x] COVID年の視覚的区別（薄い色のバー）
- [x] 目標値の点線表示
- [x] 未公表データの明示（「未公表」ラベル）
- [x] 有料データソースのコスト表示（💰バッジ）
- [x] データ鮮度インジケーター（最終更新日の自動表示）
- [x] graceful degradation（actual-data.js がなくても従来通り動作）
- [x] 7地域×6年分の地域別実データ
- [x] 8サブKPIの時系列データ

### データの出典・信頼性

| データ項目 | 出典 | 確認方法 | 信頼性 |
|-----------|------|---------|-------|
| 延べ入込観光客数 | 神奈川県入込観光客調査 | 公式ウェブページ直接確認 | ◎ 高 |
| 地域別入込客数 | 同上 | 公式ウェブページ直接確認 | ◎ 高 |
| 延べ宿泊者数 | 観光庁 宿泊旅行統計調査 | Excel/PDF（直接確認不可） | ○ 中（既存値を使用） |
| 観光消費額 | 神奈川県（PDF公表） | PDF内のみ（直接確認不可） | ○ 中（既存値を使用） |
| 観光客満足度 | 神奈川県観光客実態調査 | PDF内のみ（直接確認不可） | ○ 中（既存値を使用） |
| 有料データソースコスト | 各社公開情報 | ウェブ調査 | △ 参考値 |

---

## 今後の開発予定（未着手）

- [ ] PDF/Excelデータの直接解析による数値精査（観光消費額、宿泊者数、満足度）
- [ ] e-Stat API連携による自動データ取得
- [ ] データのエクスポート機能（CSV/Excel）
- [ ] アクセス制限の導入（メンバー限定公開）
- [ ] クラウドホスティングへの移行
- [ ] BIツール（Tableau/Power BI等）との連携設計
